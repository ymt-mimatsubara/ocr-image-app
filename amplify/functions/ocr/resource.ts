// amplify/functions/ocr/resource.ts（完成版）
// lambdaの側の定義（中身は別）
// 複数のlambdaを定義することができるが、関数ごとに分けたほうが可読性が高い
import { defineFunction } from "@aws-amplify/backend";

// ============================================================================
// 【1. Lambda関数の基本設定】
// Day1で学習したLambda関数定義の応用
// ============================================================================

export const processImageOcr = defineFunction({
  // 関数名（AWS上で識別するため）
  name: "processImageOcr",
  
  // 実行するファイル（メインのプログラム）
  entry: "./process-image-ocr.ts",
  
  // ============================================================================
  // 【2. パフォーマンス設定】
  // OCR処理は時間とメモリを多く使用するため、デフォルトから拡張
  // ============================================================================
  
  // 最大実行時間：5分（デフォルトの3秒から延長　処理に合わせて後から調整）
  // 理由：Bedrock APIの呼び出しと画像処理に時間が必要
  timeoutSeconds: 300,
  
  // 使用メモリ：1GB（デフォルトの128MBから大幅増加　処理に合わせて後から調整）
  // 理由：画像データをメモリ上で処理するため
  memoryMB: 1024,
  
  // ============================================================================
  // 【3. リソースグループ設定】
  // 循環依存を回避するための重要な設定
  // ============================================================================
  
  // storageグループに割り当て（S3との循環依存を解決）
  resourceGroupName: "storage",
});
